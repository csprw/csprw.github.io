<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casper Wortmann - Portfolio</title>
    <link rel="canonical" href="https://www.casperwortmann.com/" />
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #000000;
            font-family: 'Helvetica Neue', sans-serif;
            transition: background-color 0.8s ease, color 0.8s ease;
            overflow-x: hidden;
            /* Prevent horizontal scroll */
        }

        body {
            height: 960vh;
        }

        .fixed-viewport {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            z-index: 1;
            perspective: 1000px;
        }

        /* --- NAME STYLES --- */
        .name-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 1rem;
            z-index: 10;
            pointer-events: none;
        }

        .word {
            display: flex;
        }

        .char-wrap {
            display: inline-block;
            overflow: visible;
            opacity: 0;
            transform: translateY(60px);
            animation: slideUpFade 1s cubic-bezier(0.2, 1, 0.3, 1) forwards;
        }

        .char {
            display: inline-block;
            font-size: 8vw;
            font-weight: 800;
            text-transform: uppercase;
            line-height: 1;
            will-change: transform, opacity, filter, color;
            transition: color 0.8s ease;
        }

        .char-wrap:nth-child(1) {
            animation-delay: 0.1s;
        }

        .char-wrap:nth-child(2) {
            animation-delay: 0.15s;
        }

        .char-wrap:nth-child(3) {
            animation-delay: 0.2s;
        }

        .char-wrap:nth-child(4) {
            animation-delay: 0.25s;
        }

        .char-wrap:nth-child(5) {
            animation-delay: 0.3s;
        }

        .char-wrap:nth-child(6) {
            animation-delay: 0.35s;
        }

        .char-wrap:nth-child(7) {
            animation-delay: 0.4s;
        }

        .char-wrap:nth-child(8) {
            animation-delay: 0.45s;
        }

        @keyframes slideUpFade {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- PROJECT GALLERY STYLES --- */
        .project-gallery {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        .project-card {
            text-decoration: none;
            /* Removes underline */
            color: inherit;
            /* Prevents blue link color */
            display: block;
            /* Ensures the <a> behaves like a box */
            position: absolute;
            width: 350px;
            height: 500px;
            background-color: #222;
            overflow: hidden;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            will-change: transform;
            cursor: pointer;
            /* Change cursor to indicate clickable */
        }

        .project-card .media {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .project-card img,
        .project-card video {
            opacity: 0.9;
            transition: transform 0.6s ease, opacity 0.6s ease;
            pointer-events: none;
            /* Let clicks pass to the card div */
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }


        /* image is the guaranteed fallback */
        .project-card .media img {
            opacity: 0.95;
            transform: translateZ(0);
            /* helps iOS */
        }

        /* video starts hidden until it has a frame */
        .project-card .media video {
            opacity: 0;
            transition: opacity 250ms ease;
            transform: translateZ(0);
            /* helps iOS */
        }

        .project-card .media video.is-ready {
            opacity: 0.9;
        }

        .project-card:hover img,
        .project-card:hover video {
            transform: scale(1.05);
            opacity: 0.6;
        }

        .card-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            pointer-events: none;
            color: white;
            mix-blend-mode: difference;
            opacity: 0;
            animation: fadeInText 1s 0.8s forwards;
            transition: opacity 0.3s;
        }

        @keyframes fadeInText {
            to {
                opacity: 1;
            }
        }

        /* --- TRANSITION ANIMATION STYLES --- */

        /* The Clone Image that flies to full screen */
        .transition-clone {
            position: fixed;
            z-index: 9999;
            object-fit: cover;
            transform-origin: center center;
            transition: all 0.8s cubic-bezier(0.7, 0, 0.3, 1);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0);
            /* Removes shadow during flight */
        }

        /* Class added to body to hide everything else */
        .is-transitioning .fixed-viewport,
        .is-transitioning .content {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        @media (max-width: 768px) {
            .char {
                font-size: 14vw;
            }

            .project-card {
                width: 70vw;
                height: 90vw;
            }

            .name-container {
                flex-direction: column;
                gap: 0;
            }
        }

        .content {
            position: relative;
            top: 920vh;
            background: #000;
            color: white;
            padding: 4rem 2rem;
            min-height: 50vh;
            z-index: 20;
            border-top: 1px solid #333;
        }

        .content a {
            color: inherit;
            /* blue colors for links too */
            text-decoration: inherit;
            /* no underline */
        }

        /* --- LOADER STYLES --- */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }

        /* Optional: Simple spinner or text */
        .loader-text {
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.5;
            }
        }

        /* Stop animations from running immediately */
        .char-wrap {
            animation-play-state: paused;
            /* Pause by default */
        }

        /* When body has class "loaded", play the animations and hide loader */
        body.loaded .char-wrap {
            animation-play-state: running;
        }

        body.loaded #loader {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="loader">
        <div class="loader-text">Loading...</div>
    </div>

    <div class="fixed-viewport">

        <div class="name-container">
            <div class="word">
                <span class="char-wrap"><span class="char" data-speed="3.5">C</span></span>
                <span class="char-wrap"><span class="char" data-speed="-2.0">a</span></span>
                <span class="char-wrap"><span class="char" data-speed="4.0">s</span></span>
                <span class="char-wrap"><span class="char" data-speed="-1.0">p</span></span>
                <span class="char-wrap"><span class="char" data-speed="2.0">e</span></span>
                <span class="char-wrap"><span class="char" data-speed="-3.0">r</span></span>
            </div>
            <div class="word" style="margin-left: 2rem;">
                <span class="char-wrap"><span class="char" data-speed="-2.0">W</span></span>
                <span class="char-wrap"><span class="char" data-speed="3.0">o</span></span>
                <span class="char-wrap"><span class="char" data-speed="-1.0">r</span></span>
                <span class="char-wrap"><span class="char" data-speed="2.5">t</span></span>
                <span class="char-wrap"><span class="char" data-speed="-3.5">m</span></span>
                <span class="char-wrap"><span class="char" data-speed="1.5">a</span></span>
                <span class="char-wrap"><span class="char" data-speed="-0.5">n</span></span>
                <span class="char-wrap"><span class="char" data-speed="4.0">n</span></span>
            </div>
        </div>

        <div class="project-gallery">



            <a href="project.html?id=about" class="project-card" data-speed="0.9"
                style="top: 140vh; right: 5%; width: 300px; height: 400px; z-index: -1;">
                <video autoplay muted playsinline poster="assets/about/casperwortmann.avif">
                    <source src="assets/about/face_mesh_output.webm" type="video/webm">
                    <source src="assets/about/face_mesh_output.mp4" type="video/mp4">
                </video>
                <div class="card-text">About</div>
            </a>

            <a href="project.html?id=architecture" class="project-card" data-speed="1.2"
                style="top: 120vh; left: 20%; width: 500px; height: 350px;">
                <video autoplay muted loop playsinline poster="assets/architecture/architecture.avif">
                    <source src="assets/architecture/mayansongzoom2.webm" type="video/webm">
                    <source src="assets/architecture/mayansongzoom2.mp4" type="video/mp4">
                </video>
                <div class="card-text">Architecture<br>and<br>Emotion</div>
            </a>

            <a href="project.html?id=lollipop" class="project-card" data-speed="1.1"
                style="top: 475vh; left: 5%; width: 230px; height: 300px; z-index: -1;">
                <img src="assets/lollipop/prins.avif">
                <div class="card-text">Dear<br>Lollipop</div>
            </a>


            <a href="project.html?id=dbf" class="project-card" data-speed="1.0"
                style="top: 295vh; right: 15%; width: 500px; height: 380px;">
                <img src="assets/dbf/dbf_010.avif">
                <div class="card-text">Dear<br>Beloved<br>Friend</div>
            </a>

            <a href="project.html?id=brothers" class="project-card" data-speed="1.4"
                style="top: 270vh; left: 10%; width: 380px; height: 500px;">
                <!-- <img src="assets/brothers/broeders.gif"> -->
                <video autoplay loop muted playsinline>
                    <source data-src="assets/brothers/broeders.mp4" type="video/mp4">
                    <source data-src="assets/brothers/broeders.webm" type="video/webm">
                </video>
                <div class="card-text">Brothers</div>
            </a>

            <a href="project.html?id=grond" class="project-card" data-speed="1.2"
                style="top: 295vh; left: 20%; width: 450px; height: 300px;">
                <div class="media">
                    <img src="assets/grond/grond02.avif" alt="">
                    <video class="lazy-video" autoplay muted playsinline loop preload="none">
                        <source src="assets/grond/grondje_fbgif.webm" type="video/webm">
                        <source src="assets/grond/grondje_fbgif.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-text">Grond</div>
            </a>


            <a href="project.html?id=calling-the-shots" class="project-card" data-speed="1.4"
                style="top: 480vh; left: 5%; width: 380px; height: 300px; z-index: -1;">
                <img src="assets/cts/field_IBM_calling_the_shots_image_02.avif">
                <div class="card-text">Calling<br>The<br>Shots</div>
            </a>

            <a href="project.html?id=architecture-research" class="project-card" d data-speed="0.9"
                style="top: 350vh; right: 5%; width: 300px; height: 400px; z-index: -1;">
                <img src="assets/architecture-research/research_001.avif">
                <div class="card-text">Trash<br>vs<br>Maquette</div>
            </a>



            <a href="project.html?id=sevilla" class="project-card" ddata-speed="0.7"
                style="top: 350vh; left: 40%; width: 300px; height: 200px; z-index: -2;">
                <div class="media">
                    <img src="assets/sevilla/sevilla.jpg" alt="">
                    <video class="lazy-video" autoplay muted playsinline loop preload="none">
                        <source data-src="assets/sevilla/sevilla.mp4" type="video/mp4">
                        <source data-src="assets/sevilla/sevilla.webm" type="video/webm">
                    </video>
                </div>
                <div class="card-text">Sevilla</div>
            </a>


            <a href="project.html?id=dreaming-computer" class="project-card" d data-speed="1.11"
                style="top: 570vh; right: 5%; width: 500px; height: 300px; z-index: -2;">
                <img src="assets/dreaming-computer/dream01_fbgif.gif">
                <!-- <video autoplay muted playsinline>
                    <source data-src="assets/dreaming-computer/dream01.webm" type="video/webm">
                    <source data-src="assets/dreaming-computer/dream01.mp4" type="video/mp4">
                </video> -->
                <div class="card-text">Dreaming<br>Computer</div>
            </a>


            <a href="project.html?id=other" class="project-card" data-speed="0.9"
                style="top: 540vh; left: 15%; width: 300px; height: 400px; z-index: -3;">
                <div class="media">
                    <img src="assets/other/oprah_wide.avif" alt="">
                    <video class="lazy-video" autoplay muted playsinline loop preload="none">
                        <source data-src="assets/other/other02.mp4" type="video/mp4">
                        <source data-src="assets/other/other02.webm" type="video/webm">
                    </video>
                </div>
                <div class="card-text">Other<br>Projects</div>
            </a>

            <a href="project.html?id=oxygendepth" class="project-card" d data-speed="1.25"
                style="top: 680vh; right: 15%; width: 200px; height: 300px; z-index: -2;">
                <img src="assets/zuurstof/zuurstof.avif">
                <div class="card-text">Oxygen<br>Depth</div>
            </a>
        </div>

    </div>

    <section class="content">
        <h2>Casper Wortmann</h2>
        <p>Machine Learning engineer, Interaction designer, and Creative Technologist based in Amsterdam.</p>
        <nav class="footer-links">
            <a href="about.html">About</a>
        </nav>
    </section>

    <script>
        // -----------------------------
        // VIDEO LAZY-LOAD + VISIBILITY PLAY
        // -----------------------------
        function setupLazyVideos() {
            const videos = Array.from(document.querySelectorAll("video.lazy-video, .project-card video"));

            function prime(video) {
                video.muted = true;
                video.setAttribute("muted", "");
                video.playsInline = true;
                video.setAttribute("playsinline", "");
                video.setAttribute("preload", "none");
                // Don't show black if it fails: start hidden until ready
                video.classList.remove("is-ready");
            }

            function loadSources(video) {
                if (video.dataset.loaded === "1") return;
                const sources = Array.from(video.querySelectorAll("source"));

                // Prefer mp4 on iOS by setting mp4 first in HTML.
                sources.forEach(s => {
                    if (!s.src && s.dataset.src) s.src = s.dataset.src;
                });

                video.load();
                video.dataset.loaded = "1";
            }

            function markReady(video) {
                // First frame is available -> fade in over thumb
                video.classList.add("is-ready");
            }

            async function tryPlay(video) {
                try {
                    const p = video.play();
                    if (p && typeof p.then === "function") await p;
                } catch (e) {
                    // Autoplay blocked -> keep thumb visible (video stays hidden)
                }
            }

            function pause(video) {
                try { video.pause(); } catch (e) { }
            }

            videos.forEach(v => {
                prime(v);

                // When Safari has enough to show a frame
                v.addEventListener("loadeddata", () => markReady(v), { once: true });
                v.addEventListener("canplay", () => markReady(v), { once: true });

                // If error, stay on image
                v.addEventListener("error", () => {
                    v.classList.remove("is-ready");
                });
            });

            if (!("IntersectionObserver" in window)) {
                videos.forEach(v => {
                    loadSources(v);
                    tryPlay(v);
                });
                return;
            }

            const io = new IntersectionObserver((entries) => {
                for (const entry of entries) {
                    const v = entry.target;

                    if (entry.isIntersecting) {
                        loadSources(v);
                        tryPlay(v);
                    } else {
                        pause(v);
                        // Optional: hide video again when offscreen to reduce random iOS black frames
                        // v.classList.remove("is-ready");
                    }
                }
            }, {
                rootMargin: "600px 0px 600px 0px",
                threshold: 0.01,
            });

            videos.forEach(v => io.observe(v));

            document.addEventListener("visibilitychange", () => {
                if (document.hidden) videos.forEach(pause);
            });
        }

        // document.addEventListener("DOMContentLoaded", () => {
        //     setupLazyVideos();
        // });

        // -----------------------------
        // LOADER LOGIC (yours, with one tweak: for lazy videos we also count "loadedmetadata")
        // -----------------------------
        function setupLoader() {
            const loader = document.getElementById("loader");
            const allMedia = document.querySelectorAll(".project-card img, .project-card video");
            const mediaToLoad = Array.from(allMedia).slice(0, 3);

            const promises = mediaToLoad.map((media) => {
                return new Promise((resolve) => {
                    if (media.tagName === "IMG") {
                        if (media.complete) resolve();
                        else {
                            media.onload = resolve;
                            media.onerror = resolve;
                        }
                    } else if (media.tagName === "VIDEO") {
                        // With lazy-loading, a video might not have sources yet.
                        // We'll resolve on metadata/first frame readiness if possible, otherwise don't block loader.
                        const done = () => resolve();

                        // If already has enough data
                        if (media.readyState >= 2) {
                            done();
                        } else {
                            media.onloadedmetadata = done;
                            media.oncanplay = done;
                            media.onerror = done;

                            // Safety: don't block loader waiting for video
                            setTimeout(done, 1200);
                        }
                    } else {
                        resolve();
                    }
                });
            });

            const timeout = new Promise((resolve) => setTimeout(resolve, 4000));

            Promise.race([Promise.all(promises), timeout]).then(() => {
                document.body.classList.add("loaded");
            });
        }

        // -----------------------------
        // MAIN SCROLL + CLICK LOGIC (yours)
        // -----------------------------
        function setupMainInteractions() {
            const chars = document.querySelectorAll(".char");
            const projects = document.querySelectorAll(".project-card");
            const body = document.body;
            let isTransitioning = false;

            // --- SCROLL LOGIC ---
            window.addEventListener("scroll", () => {
                if (isTransitioning) return;

                const scrollY = window.scrollY;
                const screenH = window.innerHeight;

                // 1. Color Flip
                if (scrollY > screenH * 0.2) {
                    body.style.backgroundColor = "#000000";
                    body.style.color = "#ffffff";
                    chars.forEach((char) => (char.style.color = "#ffffff"));
                } else {
                    body.style.backgroundColor = "#ffffff";
                    body.style.color = "#000000";
                    chars.forEach((char) => (char.style.color = "#000000"));
                }

                // 2. Name Explode
                chars.forEach((char) => {
                    const speed = parseFloat(char.getAttribute("data-speed"));
                    const yPos = scrollY * speed * 0.35;
                    const dist = Math.abs(yPos);
                    const opacity = 1 - Math.min(dist / 500, 1);
                    const blur = Math.min(dist / 50, 10);
                    char.style.transform = `translate3d(0, ${yPos}px, 0)`;
                    char.style.opacity = opacity;
                    char.style.filter = `blur(${blur}px)`;
                });

                // 3. Projects Fly
                projects.forEach((card) => {
                    const speed = parseFloat(card.getAttribute("data-speed"));
                    const yMove = -scrollY * speed * 0.7;
                    card.style.transform = `translate3d(0, ${yMove}px, 0)`;
                });
            });

            // --- CLICK TRANSITION LOGIC ---
            projects.forEach((card) => {
                card.addEventListener("click", (e) => {
                    e.preventDefault();
                    isTransitioning = true;

                    //const href = card.getAttribute("data-href");
                    const href = card.getAttribute("href");

                    // 1. Detect if it's an Image or Video
                    let media = card.querySelector("img");
                    let isVideo = false;

                    if (!media) {
                        media = card.querySelector("video");
                        isVideo = true;
                    }

                    const rect = card.getBoundingClientRect();

                    // 2. Create the appropriate Clone (Image or Video)
                    let clone;
                    if (isVideo) {
                        clone = document.createElement("video");

                        // If your sources are lazy (data-src), try to pick the mp4 first
                        const sources = Array.from(media.querySelectorAll("source"));
                        const mp4 = sources.find((s) => (s.type || "").includes("mp4"));
                        const any = sources[0];

                        const chosen = mp4 || any;
                        const src = (chosen && (chosen.src || chosen.dataset.src)) || media.src;

                        clone.src = src;
                        clone.muted = true;
                        clone.setAttribute("muted", "");
                        clone.loop = true;
                        clone.autoplay = true;
                        clone.playsInline = true;
                        clone.setAttribute("playsinline", "");
                    } else {
                        clone = document.createElement("img");
                        clone.src = media.src;
                    }

                    clone.classList.add("transition-clone");

                    // Set initial position
                    clone.style.top = rect.top + "px";
                    clone.style.left = rect.left + "px";
                    clone.style.width = rect.width + "px";
                    clone.style.height = rect.height + "px";

                    document.body.appendChild(clone);
                    document.body.classList.add("is-transitioning");

                    // Force Reflow
                    void clone.offsetWidth;

                    // Animate
                    clone.style.top = "0";
                    clone.style.left = "0";
                    clone.style.width = "100vw";
                    clone.style.height = "100vh";

                    setTimeout(() => {
                        window.location.href = href;
                    }, 800);
                });
            });

            window.addEventListener("pageshow", () => {
                const existingClones = document.querySelectorAll(".transition-clone");
                if (existingClones.length > 0) {
                    existingClones.forEach((clone) => clone.remove());
                    document.body.classList.remove("is-transitioning");
                    isTransitioning = false;
                }
            });
        }

        // -----------------------------
        // INIT
        // -----------------------------
        document.addEventListener("DOMContentLoaded", () => {
            setupLazyVideos();
            setupLoader();
            setupMainInteractions();
        });
    </script>



</body>

</html>